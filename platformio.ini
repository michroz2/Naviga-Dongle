; Платформа и плата: T-Beam v1.1
[env:dongle_tbeam_E22]
platform = espressif32
board = ttgo-t-beam
framework = arduino

; Скорость монитора порта
monitor_speed = 115200
monitor_raw = yes


; Настройки разделов памяти (Partition Scheme)
; Meshtastic использует huge_app или кастомную таблицу, чтобы вместить Bluetooth стек
board_build.partitions = huge_app.csv

; === БИБЛИОТЕКИ MESHTASTIC ===
lib_deps =
    ; Драйвер LoRa (SX1262/SX1268 и др.)
    jgromes/RadioLib @ ^6.6.0
    
    ; Управление питанием AXP2101 (критично для T-Beam v1.1)
    lewisxhe/XPowersLib @ ^0.2.1
    
    ; Легковесный стек Bluetooth (используется в Meshtastic вместо Bluedroid)
    h2zero/NimBLE-Arduino @ ^1.4.1
    
    ; Драйвер GPS
    mikalhart/TinyGPSPlus @ ^1.0.3
    
    ; Драйвер OLED дисплея
    thingpulse/ESP8266 and ESP32 OLED driver for SSD1306 displays @ ^4.4.0

; === ФЛАГИ КОМПИЛЯЦИИ ===
build_flags = 
    -D CORE_DEBUG_LEVEL=3          ; Уровень отладки (Info)
    -D ARDUINO_USB_CDC_ON_BOOT=0   ; Обязательно 0 для T-Beam v1.1 (иначе Serial не определен)

    -D RADIOLIB_EXCLUDE_CC1101
    -D RADIOLIB_EXCLUDE_RF69
    -D RADIOLIB_EXCLUDE_SX1231
    -D RADIOLIB_EXCLUDE_SX127X     ; Исключаем SX127x (родной чип T-Beam), так как у нас E22
    -D RADIOLIB_EXCLUDE_SX128X
    -D RADIOLIB_EXCLUDE_SI443X
    -D RADIOLIB_EXCLUDE_NRF24
    -D RADIOLIB_EXCLUDE_LR11X0
    
    ; === ОПТИМИЗАЦИЯ ПРОТОКОЛОВ ===
    -D RADIOLIB_EXCLUDE_APRS
    -D RADIOLIB_EXCLUDE_AX25
    -D RADIOLIB_EXCLUDE_MORSE
    -D RADIOLIB_EXCLUDE_RTTY
    -D RADIOLIB_EXCLUDE_SSTV
    -D RADIOLIB_EXCLUDE_PAGER
    -D RADIOLIB_EXCLUDE_HELLSCHREIBER
    -D RADIOLIB_EXCLUDE_AFSK
    -D RADIOLIB_EXCLUDE_BELL       ; Исправление: BellModem зависит от AFSK
    -D RADIOLIB_EXCLUDE_FSK4       ; Дополнительно убираем FSK4
    -D RADIOLIB_EXCLUDE_EXTERNAL_RADIO